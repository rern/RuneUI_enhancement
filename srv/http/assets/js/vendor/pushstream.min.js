(function(I,f,p){if(I.PushStream){return}var G={};var g=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var w=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var v=function(P){return((P<10)?"0":"")+P};G.dateToUTCString=function(P){var Q=v(P.getUTCHours())+":"+v(P.getUTCMinutes())+":"+v(P.getUTCSeconds());return g[P.getUTCDay()]+", "+v(P.getUTCDate())+" "+w[P.getUTCMonth()]+" "+P.getUTCFullYear()+" "+Q+" GMT"};var m=function(){var Q=arguments[0]||{};for(var R=0;R<arguments.length;R++){var S=arguments[R];for(var P in S){if(!S.hasOwnProperty||S.hasOwnProperty(P)){Q[P]=S[P]}}}return Q};var L=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,o=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,j=/(?:^|:|,)(?:\s*\[)+/g;var a=function(P){return P.replace(/^\s*/,"").replace(/\s*$/,"")};G.parseJSON=function(P){if(!P||!k(P)){return null}P=a(P);if(I.JSON&&I.JSON.parse){try{return I.JSON.parse(P)}catch(Q){throw"Invalid JSON: "+P}}if(L.test(P.replace(d,"@").replace(o,"]").replace(j,""))){return(new Function("return "+P))()}throw"Invalid JSON: "+P};var r=function(Q){var P={};P[Q.tagArgument]="";P[Q.timeArgument]="";P[Q.eventIdArgument]="";if(Q.messagesControlByArgument){P[Q.tagArgument]=Number(Q._etag);if(Q._lastModified){P[Q.timeArgument]=Q._lastModified}else{if(Q._lastEventId){P[Q.eventIdArgument]=Q._lastEventId}}}return P};var s=function(){return(new Date()).getTime()};var b=function(){return{_:s()}};var F=function(Q){var R=Q;if(typeof(Q)==="object"){R="";for(var P in Q){if(!Q.hasOwnProperty||Q.hasOwnProperty(P)){R+="&"+P+"="+A(Q[P])}}R=R.substring(1)}return R||""};var O=function(P,Q){return P+((P.indexOf("?")<0)?"?":"&")+F(Q)};var y=Array.isArray||function(P){return Object.prototype.toString.call(P)==="[object Array]"};var k=function(P){return Object.prototype.toString.call(P)==="[object String]"};var x=function(P){return Object.prototype.toString.call(P)==="[object Date]"};var t={logger:null,debug:function(){if(e.LOG_LEVEL==="debug"){t._log.apply(t._log,arguments)}},info:function(){if((e.LOG_LEVEL==="info")||(e.LOG_LEVEL==="debug")){t._log.apply(t._log,arguments)}},error:function(){t._log.apply(t._log,arguments)},_initLogger:function(){var P=I.console;if(P&&P.log){if(P.log.apply){t.logger=P.log}else{if((typeof P.log==="object")&&Function.prototype.bind){t.logger=Function.prototype.bind.call(P.log,P)}else{if((typeof P.log==="object")&&Function.prototype.call){t.logger=function(){Function.prototype.call.call(P.log,P,Array.prototype.slice.call(arguments))}}}}}},_log:function(){if(!t.logger){t._initLogger()}if(t.logger){try{t.logger.apply(I.console,arguments)}catch(S){t._initLogger();if(t.logger){t.logger.apply(I.console,arguments)}}}var R=f.getElementById(e.LOG_OUTPUT_ELEMENT_ID);if(R){var T="";for(var Q=0;Q<arguments.length;Q++){T+=arguments[Q]+" "}R.innerHTML+=T+"\n";var P=R.innerHTML.split("\n");if(P.length>100){R.innerHTML=P.slice(-100).join("\n")}}}};var z={_getXHRObject:function(Q){var U=false;if(Q){try{U=new I.XDomainRequest()}catch(S){}if(U){return U}}try{U=new I.XMLHttpRequest()}catch(T){try{U=new I.ActiveXObject("Msxml2.XMLHTTP")}catch(R){try{U=new I.ActiveXObject("Microsoft.XMLHTTP")}catch(P){U=false}}}return U},_send:function(S,R){S=S||{};S.timeout=S.timeout||30000;var U=z._getXHRObject(S.crossDomain);if(!U||!S.url){return}z.clear(S);S.xhr=U;if(I.XDomainRequest&&(U instanceof I.XDomainRequest)){U.onload=function(){if(S.afterReceive){S.afterReceive(U)}if(S.success){S.success(U.responseText)}};U.onerror=U.ontimeout=function(){if(S.afterReceive){S.afterReceive(U)}if(S.error){S.error(U.status)}}}else{U.onreadystatechange=function(){if(U.readyState===4){z.clear(S);if(S.afterReceive){S.afterReceive(U)}if(U.status===200){if(S.success){S.success(U.responseText)}}else{if(S.error){S.error(U.status)}}}}}if(S.beforeOpen){S.beforeOpen(U)}var T={};var Q=null;var V="GET";if(R){Q=F(S.data);V="POST"}else{T=S.data||{}}U.open(V,O(S.url,m({},T,b())),true);if(S.beforeSend){S.beforeSend(U)}var P=function(){z.clear(S);try{U.abort()}catch(W){}S.error(304)};if(R){if(U.setRequestHeader){U.setRequestHeader("Accept","application/json");U.setRequestHeader("Content-type","application/x-www-form-urlencoded")}}else{S.timeoutId=I.setTimeout(P,S.timeout+2000)}U.send(Q);return U},_clear_xhr:function(P){if(P){P.onreadystatechange=null}},_clear_script:function(P){if(P){P.onerror=P.onload=P.onreadystatechange=null;if(P.parentNode){P.parentNode.removeChild(P)}}},_clear_timeout:function(P){P.timeoutId=M(P.timeoutId)},_clear_jsonp:function(P){var Q=P.data.callback;if(Q){I[Q]=function(){I[Q]=null}}},clear:function(P){z._clear_timeout(P);z._clear_jsonp(P);z._clear_script(f.getElementById(P.scriptId));z._clear_xhr(P.xhr)},jsonp:function(U){U.timeout=U.timeout||30000;z.clear(U);var S=f.head||f.getElementsByTagName("head")[0];var R=f.createElement("script");var T=s();var Q=function(){z.clear(U);var W=s();U.error(((W-T)>U.timeout/2)?304:403)};var V=function(){z.clear(U);U.load()};var P=function(){U.afterSuccess=true;U.success.apply(null,arguments)};R.onerror=Q;R.onload=R.onreadystatechange=function(W){if(!R.readyState||/loaded|complete/.test(R.readyState)){if(U.afterSuccess){V()}else{Q()}}};if(U.beforeOpen){U.beforeOpen({})}if(U.beforeSend){U.beforeSend({})}U.timeoutId=I.setTimeout(Q,U.timeout+2000);U.scriptId=U.scriptId||s();U.afterSuccess=null;U.data.callback=U.scriptId+"_onmessage_"+s();I[U.data.callback]=P;R.setAttribute("src",O(U.url,m({},U.data,b())));R.setAttribute("async","async");R.setAttribute("id",U.scriptId);S.insertBefore(R,S.firstChild);return U},load:function(P){return z._send(P,false)},post:function(P){return z._send(P,true)}};var A=function(P){return(P)?I.encodeURIComponent(P):""};var B=function(P){return(P)?I.decodeURIComponent(P):""};G.parseMessage=function(R,Q){var S=R;if(k(R)){S=G.parseJSON(R)}var P={id:S[Q.jsonIdKey],channel:S[Q.jsonChannelKey],text:k(S[Q.jsonTextKey])?B(S[Q.jsonTextKey]):S[Q.jsonTextKey],tag:S[Q.jsonTagKey],time:S[Q.jsonTimeKey],eventid:S[Q.jsonEventIdKey]||""};return P};var l=function(P){return(P.backtrack)?".b"+Number(P.backtrack):""};var q=function(P,R){var S="";for(var Q in P){if(!P.hasOwnProperty||P.hasOwnProperty(Q)){S+="/"+Q+(R?l(P[Q]):"")}}return S};var i=function(T,V,W,Y){var R=T.wrapper.type===H.TYPE;var S=T.useSSL;var Q=n(S,T.port);var P=(R)?((S)?"wss://":"ws://"):((S)?"https://":"http://");P+=T.host;P+=(Q?(":"+Q):"");P+=V;var U=q(T.channels,Y);if(T.channelsByArgument){var X={};X[T.channelsArgument]=U.substring(1);W=m({},W,X)}else{P+=U}return O(P,W)};var E=function(R){var P=n(R.useSSL,R.port);var Q=(R.useSSL)?"https://":"http://";Q+=R.host;Q+=(P?(":"+P):"");Q+=R.urlPrefixPublisher;Q+="?id="+q(R.channels,false);return Q};G.extract_xss_domain=function(Q){if(Q.match(/^(\d{1,3}\.){3}\d{1,3}$/)){return Q}var R=Q.split(".");var P=Math.max(R.length-1,(Q.match(/(\w{4,}\.\w{2}|\.\w{3,})$/)?2:3));return R.slice(-1*P).join(".")};var n=function(Q,P){P=Number(P||(Q?443:80));return((!Q&&P===80)||(Q&&P===443))?"":P};G.isCrossDomainUrl=function(P){if(!P){return false}var S=f.createElement("a");S.href=P;var Q=n(I.location.protocol==="https:",I.location.port);var R=n(S.protocol==="https:",S.port);return(I.location.protocol!==S.protocol)||(I.location.hostname!==S.hostname)||(Q!==R)};var C=function(Q,P){return function(){return Q.apply(P,arguments)}};var M=function(P){if(P){I.clearTimeout(P)}return null};var h=function(Q){t.info("["+this.type+"] message received",arguments);var P=G.parseMessage(Q.data,this.pushstream);if(P.tag){this.pushstream._etag=P.tag}if(P.time){this.pushstream._lastModified=P.time}if(P.eventid){this.pushstream._lastEventId=P.eventid}this.pushstream._onmessage(P.text,P.id,P.channel,P.eventid,true,P.time)};var J=function(){this.pushstream._onopen();t.info("["+this.type+"] connection opened")};var N=function(P){t.info("["+this.type+"] error (disconnected by server):",P);if((this.pushstream.readyState===e.OPEN)&&(this.type===u.TYPE)&&(P.type==="error")&&(this.connection.readyState===I.EventSource.CONNECTING)){return}this._closeCurrentConnection();this.pushstream._onerror({type:((P&&((P.type==="load")||((P.type==="close")&&(P.code===1006))))||(this.pushstream.readyState===e.CONNECTING))?"load":"timeout"})};var H=function(P){if(!I.WebSocket&&!I.MozWebSocket){throw"WebSocket not supported"}this.type=H.TYPE;this.pushstream=P;this.connection=null};H.TYPE="WebSocket";H.prototype={connect:function(){this._closeCurrentConnection();var Q=m({},this.pushstream.extraParams(),b(),r(this.pushstream));var P=i(this.pushstream,this.pushstream.urlPrefixWebsocket,Q,!this.pushstream._useControlArguments());this.connection=(I.WebSocket)?new I.WebSocket(P):new I.MozWebSocket(P);this.connection.onerror=C(N,this);this.connection.onclose=C(N,this);this.connection.onopen=C(J,this);this.connection.onmessage=C(h,this);t.info("[WebSocket] connecting to:",P)},disconnect:function(){if(this.connection){t.debug("[WebSocket] closing connection to:",this.connection.url);this.connection.onclose=null;this._closeCurrentConnection();this.pushstream._onclose()}},_closeCurrentConnection:function(){if(this.connection){try{this.connection.close()}catch(P){}this.connection=null}},sendMessage:function(P){if(this.connection){this.connection.send(P)}}};var u=function(P){if(!I.EventSource){throw"EventSource not supported"}this.type=u.TYPE;this.pushstream=P;this.connection=null};u.TYPE="EventSource";u.prototype={connect:function(){this._closeCurrentConnection();var Q=m({},this.pushstream.extraParams(),b(),r(this.pushstream));var P=i(this.pushstream,this.pushstream.urlPrefixEventsource,Q,!this.pushstream._useControlArguments());this.connection=new I.EventSource(P);this.connection.onerror=C(N,this);this.connection.onopen=C(J,this);this.connection.onmessage=C(h,this);t.info("[EventSource] connecting to:",P)},disconnect:function(){if(this.connection){t.debug("[EventSource] closing connection to:",this.connection.url);this.connection.onclose=null;this._closeCurrentConnection();this.pushstream._onclose()}},_closeCurrentConnection:function(){if(this.connection){try{this.connection.close()}catch(P){}this.connection=null}}};var D=function(P){this.type=D.TYPE;this.pushstream=P;this.connection=null;this.url=null;this.frameloadtimer=null;this.pingtimer=null;this.iframeId="PushStreamManager_"+P.id};D.TYPE="Stream";D.prototype={connect:function(){this._closeCurrentConnection();var P=G.extract_xss_domain(this.pushstream.host);try{f.domain=P}catch(Q){t.error("[Stream] (warning) problem setting document.domain = "+P+" (OBS: IE8 does not support set IP numbers as domain)")}var R=m({},this.pushstream.extraParams(),b(),{streamid:this.pushstream.id},r(this.pushstream));this.url=i(this.pushstream,this.pushstream.urlPrefixStream,R,!this.pushstream._useControlArguments());t.debug("[Stream] connecting to:",this.url);this.loadFrame(this.url)},disconnect:function(){if(this.connection){t.debug("[Stream] closing connection to:",this.url);this._closeCurrentConnection();this.pushstream._onclose()}},_clear_iframe:function(){var P=f.getElementById(this.iframeId);if(P){P.onload=null;P.src="about:blank";if(P.parentNode){P.parentNode.removeChild(P)}}},_closeCurrentConnection:function(){this._clear_iframe();if(this.connection){this.pingtimer=M(this.pingtimer);this.frameloadtimer=M(this.frameloadtimer);this.connection=null;this.transferDoc=null;if(typeof I.CollectGarbage==="function"){I.CollectGarbage()}}},loadFrame:function(P){this._clear_iframe();var R=null;if("ActiveXObject" in I){var Q=new I.ActiveXObject("htmlfile");Q.open();Q.write("\x3Chtml\x3E\x3Cscript\x3Edocument.domain='"+f.domain+"';\x3C/script\x3E");Q.write("\x3Cbody\x3E\x3Ciframe id='"+this.iframeId+"' src='"+P+"'\x3E\x3C/iframe\x3E\x3C/body\x3E\x3C/html\x3E");Q.parentWindow.PushStream=e;Q.close();R=Q.getElementById(this.iframeId);this.transferDoc=Q}else{R=f.createElement("IFRAME");R.style.width="1px";R.style.height="1px";R.style.border="none";R.style.position="absolute";R.style.top="-10px";R.style.marginTop="-10px";R.style.zIndex="-20";R.PushStream=e;f.body.appendChild(R);R.setAttribute("src",P);R.setAttribute("id",this.iframeId)}R.onload=C(N,this);this.connection=R;this.frameloadtimer=I.setTimeout(C(N,this),this.pushstream.timeout)},register:function(P){this.frameloadtimer=M(this.frameloadtimer);P.p=C(this.process,this);this.connection.onload=C(this._onframeloaded,this);this.pushstream._onopen();this.setPingTimer();t.info("[Stream] frame registered")},process:function(U,R,T,Q,S,P){this.pingtimer=M(this.pingtimer);t.info("[Stream] message received",arguments);if(U!==-1){if(P){this.pushstream._etag=P}if(S){this.pushstream._lastModified=S}if(Q){this.pushstream._lastEventId=Q}}this.pushstream._onmessage(B(T),U,R,Q||"",true,S);this.setPingTimer()},_onframeloaded:function(){t.info("[Stream] frame loaded (disconnected by server)");this.pushstream._onerror({type:"timeout"});this.connection.onload=null;this.disconnect()},setPingTimer:function(){if(this.pingtimer){M(this.pingtimer)}this.pingtimer=I.setTimeout(C(N,this),this.pushstream.pingtimeout)}};var c=function(P){this.type=c.TYPE;this.pushstream=P;this.connection=null;this.opentimer=null;this.messagesQueue=[];this._linkedInternalListen=C(this._internalListen,this);this.xhrSettings={timeout:this.pushstream.timeout,data:{},url:null,success:C(this.onmessage,this),error:C(this.onerror,this),load:C(this.onload,this),beforeSend:C(this.beforeSend,this),afterReceive:C(this.afterReceive,this)}};c.TYPE="LongPolling";c.prototype={connect:function(){this.messagesQueue=[];this._closeCurrentConnection();this.urlWithBacktrack=i(this.pushstream,this.pushstream.urlPrefixLongpolling,{},true);this.urlWithoutBacktrack=i(this.pushstream,this.pushstream.urlPrefixLongpolling,{},false);this.xhrSettings.url=this.urlWithBacktrack;this.useJSONP=this.pushstream._crossDomain||this.pushstream.useJSONP;this.xhrSettings.scriptId="PushStreamManager_"+this.pushstream.id;if(this.useJSONP){this.pushstream.messagesControlByArgument=true}this._listen();this.opentimer=I.setTimeout(C(J,this),150);t.info("[LongPolling] connecting to:",this.xhrSettings.url)},_listen:function(){if(this._internalListenTimeout){M(this._internalListenTimeout)}this._internalListenTimeout=I.setTimeout(this._linkedInternalListen,100)},_internalListen:function(){if(this.pushstream._keepConnected){this.xhrSettings.url=this.pushstream._useControlArguments()?this.urlWithoutBacktrack:this.urlWithBacktrack;this.xhrSettings.data=m({},this.pushstream.extraParams(),this.xhrSettings.data,r(this.pushstream));if(this.useJSONP){this.connection=z.jsonp(this.xhrSettings)}else{if(!this.connection){this.connection=z.load(this.xhrSettings)}}}},disconnect:function(){if(this.connection){t.debug("[LongPolling] closing connection to:",this.xhrSettings.url);this._closeCurrentConnection();this.pushstream._onclose()}},_closeCurrentConnection:function(){this.opentimer=M(this.opentimer);if(this.connection){try{this.connection.abort()}catch(P){try{z.clear(this.connection)}catch(Q){}}this.connection=null;this.xhrSettings.url=null}},beforeSend:function(P){if(!this.pushstream.messagesControlByArgument){P.setRequestHeader("If-None-Match",this.pushstream._etag);P.setRequestHeader("If-Modified-Since",this.pushstream._lastModified)}},afterReceive:function(P){if(!this.pushstream.messagesControlByArgument){this.pushstream._etag=P.getResponseHeader("Etag");this.pushstream._lastModified=P.getResponseHeader("Last-Modified")}this.connection=null},onerror:function(P){this._closeCurrentConnection();if(this.pushstream._keepConnected){if(P===304){this._listen()}else{t.info("[LongPolling] error (disconnected by server):",P);this.pushstream._onerror({type:((P===403)||(this.pushstream.readyState===e.CONNECTING))?"load":"timeout"})}}},onload:function(){this._listen()},onmessage:function(T){if(this._internalListenTimeout){M(this._internalListenTimeout)}t.info("[LongPolling] message received",T);var P=null;var S=y(T)?T:T.replace(/\}\{/g,"}\r\n{").split("\r\n");for(var Q=0;Q<S.length;Q++){if(S[Q]){P=G.parseMessage(S[Q],this.pushstream);this.messagesQueue.push(P);if(this.pushstream.messagesControlByArgument&&P.time){this.pushstream._etag=P.tag;this.pushstream._lastModified=P.time}}}this._listen();while(this.messagesQueue.length>0){var R=this.messagesQueue.shift();this.pushstream._onmessage(R.text,R.id,R.channel,R.eventid,(this.messagesQueue.length===0),R.time)}}};var K=[];var e=function(Q){Q=Q||{};this.id=K.push(this)-1;this.useSSL=Q.useSSL||false;this.host=Q.host||I.location.hostname;this.port=Number(Q.port||(this.useSSL?443:80));this.timeout=Q.timeout||30000;this.pingtimeout=Q.pingtimeout||30000;this.reconnectOnTimeoutInterval=Q.reconnectOnTimeoutInterval||3000;this.reconnectOnChannelUnavailableInterval=Q.reconnectOnChannelUnavailableInterval||60000;this.autoReconnect=(Q.autoReconnect!==false);this.lastEventId=Q.lastEventId||null;this.messagesPublishedAfter=Q.messagesPublishedAfter;this.messagesControlByArgument=Q.messagesControlByArgument||false;this.tagArgument=Q.tagArgument||"tag";this.timeArgument=Q.timeArgument||"time";this.eventIdArgument=Q.eventIdArgument||"eventid";this.useJSONP=Q.useJSONP||false;this._reconnecttimer=null;this._etag=0;this._lastModified=null;this._lastEventId=null;this.urlPrefixPublisher=Q.urlPrefixPublisher||"/pub";this.urlPrefixStream=Q.urlPrefixStream||"/sub";this.urlPrefixEventsource=Q.urlPrefixEventsource||"/ev";this.urlPrefixLongpolling=Q.urlPrefixLongpolling||"/lp";this.urlPrefixWebsocket=Q.urlPrefixWebsocket||"/ws";this.jsonIdKey=Q.jsonIdKey||"id";this.jsonChannelKey=Q.jsonChannelKey||"channel";this.jsonTextKey=Q.jsonTextKey||"text";this.jsonTagKey=Q.jsonTagKey||"tag";this.jsonTimeKey=Q.jsonTimeKey||"time";this.jsonEventIdKey=Q.jsonEventIdKey||"eventid";this.modes=(Q.modes||"eventsource|websocket|stream|longpolling").split("|");this.wrappers=[];this.wrapper=null;this.onchanneldeleted=Q.onchanneldeleted||null;this.onmessage=Q.onmessage||null;this.onerror=Q.onerror||null;this.onstatuschange=Q.onstatuschange||null;this.extraParams=Q.extraParams||function(){return{}};this.channels={};this.channelsCount=0;this.channelsByArgument=Q.channelsByArgument||false;this.channelsArgument=Q.channelsArgument||"channels";this._crossDomain=G.isCrossDomainUrl(E(this));for(var P=0;P<this.modes.length;P++){try{var S=null;switch(this.modes[P]){case"websocket":S=new H(this);break;case"eventsource":S=new u(this);break;case"longpolling":S=new c(this);break;case"stream":S=new D(this);break}this.wrappers[this.wrappers.length]=S}catch(R){t.info(R)}}this.readyState=0};e.LOG_LEVEL="error";e.LOG_OUTPUT_ELEMENT_ID="Log4jsLogOutput";e.CLOSED=0;e.CONNECTING=1;e.OPEN=2;e.prototype={addChannel:function(Q,P){if(A(Q)!==Q){throw"Invalid channel name! Channel has to be a set of [a-zA-Z0-9]"}t.debug("entering addChannel");if(typeof(this.channels[Q])!=="undefined"){throw"Cannot add channel "+Q+": already subscribed"}P=P||{};t.info("adding channel",Q,P);this.channels[Q]=P;this.channelsCount++;if(this.readyState!==e.CLOSED){this.connect()}t.debug("leaving addChannel")},removeChannel:function(P){if(this.channels[P]){t.info("removing channel",P);delete this.channels[P];this.channelsCount--}},removeAllChannels:function(){t.info("removing all channels");this.channels={};this.channelsCount=0},_setState:function(P){if(this.readyState!==P){t.info("status changed",P);this.readyState=P;if(this.onstatuschange){this.onstatuschange(this.readyState)}}},connect:function(){t.debug("entering connect");if(!this.host){throw"PushStream host not specified"}if(isNaN(this.port)){throw"PushStream port not specified"}if(!this.channelsCount){throw"No channels specified"}if(this.wrappers.length===0){throw"No available support for this browser"}this._keepConnected=true;this._lastUsedMode=0;this._connect();t.debug("leaving connect")},disconnect:function(){t.debug("entering disconnect");this._keepConnected=false;this._disconnect();this._setState(e.CLOSED);t.info("disconnected");t.debug("leaving disconnect")},_useControlArguments:function(){return this.messagesControlByArgument&&((this._lastModified!==null)||(this._lastEventId!==null))},_connect:function(){if(this._lastEventId===null){this._lastEventId=this.lastEventId}if(this._lastModified===null){var Q=this.messagesPublishedAfter;if(!x(Q)){var P=Number(this.messagesPublishedAfter);if(P>0){Q=new Date();Q.setTime(Q.getTime()-(P*1000))}else{if(P<0){Q=new Date(0)}}}if(x(Q)){this._lastModified=G.dateToUTCString(Q)}}this._disconnect();this._setState(e.CONNECTING);this.wrapper=this.wrappers[this._lastUsedMode++%this.wrappers.length];try{this.wrapper.connect()}catch(R){if(this.wrapper){this.wrapper.disconnect()}}},_disconnect:function(){this._reconnecttimer=M(this._reconnecttimer);if(this.wrapper){this.wrapper.disconnect()}},_onopen:function(){this._reconnecttimer=M(this._reconnecttimer);this._setState(e.OPEN);if(this._lastUsedMode>0){this._lastUsedMode--}},_onclose:function(){this._reconnecttimer=M(this._reconnecttimer);this._setState(e.CLOSED);this._reconnect(this.reconnectOnTimeoutInterval)},_onmessage:function(T,U,Q,P,R,S){t.debug("message",T,U,Q,P,R,S);if(U===-2){if(this.onchanneldeleted){this.onchanneldeleted(Q)}}else{if(U>0){if(this.onmessage){this.onmessage(T,U,Q,P,R,S)}}}},_onerror:function(P){this._setState(e.CLOSED);this._reconnect((P.type==="timeout")?this.reconnectOnTimeoutInterval:this.reconnectOnChannelUnavailableInterval);if(this.onerror){this.onerror(P)}},_reconnect:function(P){if(this.autoReconnect&&this._keepConnected&&!this._reconnecttimer&&(this.readyState!==e.CONNECTING)){t.info("trying to reconnect in",P);this._reconnecttimer=I.setTimeout(C(this._connect,this),P)}},sendMessage:function(R,P,Q){R=A(R);if(this.wrapper.type===H.TYPE){this.wrapper.sendMessage(R);if(P){P()}}else{z.post({url:E(this),data:R,success:P,error:Q,crossDomain:this._crossDomain})}}};e.sendMessage=function(R,S,P,Q){z.post({url:R,data:A(S),success:P,error:Q})};e.register=function(P){var Q=P.window.location.href.match(/streamid=([0-9]*)&?/);if(Q[1]&&K[Q[1]]){K[Q[1]].wrapper.register(P)}};e.unload=function(){for(var P=0;P<K.length;P++){try{K[P].disconnect()}catch(Q){}}};I.PushStream=e;I.PushStreamManager=K;if(I.attachEvent){I.attachEvent("onunload",e.unload)}if(I.addEventListener){I.addEventListener.call(I,"unload",e.unload,false)}})(window,document);