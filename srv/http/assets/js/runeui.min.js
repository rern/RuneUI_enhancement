var GUI={DBentry:["","",""],DBupdate:0,activePlayer:"",browsemode:"file",checkvol:0,currentDBpos:[0,0,0,0,0,0,0,0,0,0,0],currentDBpath:["","","","","","","","","","",""],currentalbum:null,currentknob:null,currentpath:"",currentsong:null,json:0,libraryhome:"",forceGUIupdate:false,maxvol:100,minvol:0,mode:"websocket",noticeUI:{},playlist:null,plugin:"",state:"",old_state:"none",stepVolumeDelta:0,stepVolumeInt:0,stream:"",visibility:"visible",vol_changed_local:0,volume:null,clientUUID:null};function generateUUID(){var d=(new Date).getTime();var uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c=="x"?r:r&3|8).toString(16)});return uuid}function sendCmd(inputcmd){$.ajax({type:"GET",url:"/command/?cmd="+inputcmd+"&clientUUID="+GUI.clientUUID,cache:false})}function checkWebSocket(){if(window.WebSocket){return"websocket"}else{return"longpolling"}}function checkWorkers(){if(window.Worker&&window.Blob||Modernizr.webworkers&&Modernizr.blobconstructor){return true}else{return false}}function parsePath(str){var cutpos=str&&str.length?str.lastIndexOf("/"):0;var songpath="";if(cutpos&&cutpos!==-1){songpath=str.slice(0,cutpos)}return songpath}var idleTime=0;var viewScreenSaver=0;var widthScreenSaver=0;var isLocalHost=0;var SStime=-1;$(document).ready(function(){GUI.clientUUID=generateUUID();if($("#section-index").length){if(location.hostname==="localhost"||location.hostname==="127.0.0.1"){isLocalHost=1;SStime=localSStime}else{isLocalHost=0;SStime=remoteSStime}if(SStime>=0){var idleInterval=setInterval(timerIncrement,1e3)}$(this).on("mousemove click keypress",function(e){idleTime=0;if(viewScreenSaver){$(".tab-content").show("slow");$(".screen-saver-content").hide("slow");$("#menu-bottom").show("slow");$("#menu-top").show("slow");viewScreenSaver=0}})}});function timerIncrement(){if($("#section-index").length&&GUI.state==="play"){idleTime=idleTime+1}else{idleTime=0}if(idleTime>SStime){$(".tab-content").hide("slow");$(".screen-saver-content").show("slow");$("#menu-bottom").hide("slow");$("#menu-top").hide("slow");viewScreenSaver=1}}function refreshTimer(startFrom,stopTo,state){var display=$("#countdown-display");if(state!=="play"){}var displayss=$("#countdown-display-ss");if(state!=="play"){}}function timeConvert(seconds){var minutes=Math.floor(seconds/60);seconds-=minutes*60;var mm=minutes<10?"0"+minutes:minutes;var ss=seconds<10?"0"+seconds:seconds;return mm+":"+ss}function timeConvert2(ss){var hr=Math.floor(ss/3600);var mm=Math.floor((ss-hr*3600)/60);ss=Math.floor(ss-hr*3600-mm*60);if(hr>0){if(hr<10){hr="0"+hr}hr+=":"}else{hr=""}if(mm<10){mm="0"+mm}if(ss<10){ss="0"+ss}return hr+mm+":"+ss}function timeConvert3(ss){var hr=Math.floor(ss/3600);var mm=Math.floor((ss-hr*3600)/60);ss=Math.floor(ss-hr*3600-mm*60);if(hr>0){if(hr<10){hr="0"+hr+"h "}hr+="h "}else{hr=""}if(mm<10){mm="0"+mm}if(ss<10){ss="0"+ss}return hr+mm+"m "+ss+"s"}function countdownRestart(startFrom){}function reset_vol_changed_local(){GUI.vol_changed_local=0}function volumeStepCalc(direction){var i=0;var way=direction;GUI.volume=parseInt($("#volume").val());var volumeStep=function volumeStepCycle(way){i++;if(direction==="up"){GUI.stepVolumeDelta=parseInt(GUI.volume)+i}else if(direction==="dn"){GUI.stepVolumeDelta=parseInt(GUI.volume)-i}$("#volume").val(GUI.stepVolumeDelta).trigger("change")};volumeStep();GUI.stepVolumeInt=window.setInterval(function(){volumeStep()},200)}function volumeStepSet(){window.clearInterval(GUI.stepVolumeInt);setvol(GUI.stepVolumeDelta)}function customScroll(list,destination,speed){if(typeof speed==="undefined"){speed=500}var entryheight=49;var centerheight=parseInt($(window).height()/2);var scrolltop=$(window).scrollTop();var scrollcalc=0;var scrolloffset=0;if(list==="db"){scrollcalc=parseInt(destination*entryheight-centerheight);scrolloffset=scrollcalc}else if(list==="pl"){scrollcalc=parseInt((destination+2)*entryheight-centerheight);scrolloffset=Math.abs(scrollcalc-scrolltop);scrolloffset=(scrollcalc>scrolltop?"+":"-")+"="+scrolloffset+"px";$("#playlist-entries").find("li").eq(destination).addClass("active")}$.scrollTo(scrollcalc>0?scrolloffset:0,speed)}function randomScrollPL(){var n=$(".playlist li").size();var random=1+Math.floor(Math.random()*n);customScroll("pl",random)}function randomScrollDB(){var n=$(".database li").size();var random=1+Math.floor(Math.random()*n);customScroll("db",random)}function toggleLoader(action){if(action==="close"){$("#loader").addClass("hide")}else{if($("#section-dev").length){$("#loader").addClass("hide");new PNotify({title:"Warning",text:"The loading layer (spinning arrows) points to a socket error",icon:"fa fa-exclamation-circle"})}else{$("#loader").removeClass("hide")}}}function customNotify(notify){if(notify.custom==="kernelswitch"){if(GUI.noticeUI.kernelswitch!==undefined){GUI.noticeUI.kernelswitch.remove()}GUI.noticeUI.kernelswitch=new PNotify({title:"title"in notify?notify.title:"[missing title]",text:"text"in notify?notify.text:"[missing text]",icon:"fa fa-refresh",hide:false,confirm:{confirm:true,buttons:[{text:notify.btntext,addClass:"btn-default btn-block  uppercase",click:function(){$.post("/settings/",{syscmd:"reboot"});toggleLoader()}},{text:"Cancel",addClass:"hide"}]},buttons:{closer:false,sticker:false}})}}function renderMSG(text){var notify=text[0];if("custom"in notify&&notify.custom!==null){customNotify(notify);return}var noticeOptions={title:"title"in notify?notify.title:"[missing title]",text:"text"in notify?notify.text:"[missing text]",icon:notify.icon===undefined?"fa fa-check":notify.icon,opacity:notify.opacity===undefined?.9:notify.opacity,hide:notify.hide===undefined&&notify.permanotice===undefined,buttons:{closer:notify.permanotice===undefined,sticker:notify.permanotice===undefined},delay:notify.delay===undefined?8e3:notify.delay,mouse_reset:false};if("permanotice"in notify){if(GUI.noticeUI[notify.permanotice]===undefined){GUI.noticeUI[notify.permanotice]=new PNotify(noticeOptions)}else{if("permaremove"in notify){GUI.noticeUI[notify.permanotice].remove();GUI.noticeUI[notify.permanotice]=undefined}else{GUI.noticeUI[notify.permanotice].open()}}}else{new PNotify(noticeOptions)}}function sortOrder(id){var pos=$("#"+id).index();id=parseInt(id.replace("pl-",""));sendCmd("moveid "+id+" "+pos)}function loadingSpinner(section,hide){if(hide==="hide"){if(section==="db"){$("#spinner-db").addClass("hide")}if(section==="pl"){$("#spinner-pl").addClass("hide")}}else{if(section==="db"){$("#spinner-db").removeClass("hide")}if(section==="pl"){$("#spinner-pl").removeClass("hide")}}}function setPlaybackSource(){var activePlayer=GUI.libraryhome.ActivePlayer;$("#overlay-playsource-open button").text(activePlayer);$("#overlay-playsource a").addClass("inactive");var source=activePlayer.toLowerCase();$("#playsource-"+source).removeClass("inactive");if(activePlayer==="Spotify"||activePlayer==="Airplay"){$("#volume").trigger("configure",{readOnly:true,fgColor:"#1A242F"}).css({color:"#1A242F"});$("#volume-knob").addClass("nomixer");$("#volume-knob button").prop("disabled",true);$("#single").addClass("disabled")}else{$("#volume").trigger("configure",{readOnly:false,fgColor:"#0095D8"}).css({color:"#0095D8"});$("#volume-knob").removeClass("nomixer");$("#volume-knob button").prop("disabled",false);$("#single").removeClass("disabled")}$("#playlist-entries").removeClass(function(index,css){return(css.match(/(^|\s)playlist-\S+/g)||[]).join(" ")}).addClass("playlist-"+source);$("#pl-manage").removeClass(function(index,css){return(css.match(/(^|\s)pl-manage-\S+/g)||[]).join(" ")}).addClass("pl-manage-"+source)}function chkKey(key){return key!==undefined&&key!==""}function getPlaylist(text){data=text[0];if(data.length>4){$(".playlist").addClass("hide");$("#playlist-entries").removeClass("hide");getPlaylistPlain(data);var current=parseInt(GUI.json.song);if($("#panel-dx").hasClass("active")&&GUI.currentsong!==GUI.json.currentsong){customScroll("pl",current,200)}}else{$(".playlist").addClass("hide");$("#playlist-warning").removeClass("hide");$("#pl-filter-results").addClass("hide").html("");$("#pl-count").removeClass("hide").html("0 entries")}loadingSpinner("pl","hide")}function getPlaylists(){loadingSpinner("pl");$.ajax({url:"/command/?cmd=listplaylists",success:function(data){renderPlaylists(data)},cache:false})}function updatePlaylistDropdown(data){var i,line,lines=data.split("\n"),infos=[];var options="";for(i=0;line=lines[i];i+=1){infos=line.split(": ");if("playlist"===infos[0]){options+='<option value="'+infos[1]+'" />'}}document.getElementById("pl-list").innerHTML=options;loadingSpinner("pl","hide")}function getPlaylistsDropdown(){loadingSpinner("pl");$.ajax({url:"/command/?cmd=listplaylists",success:function(data){updatePlaylistDropdown(data)},cache:false})}function getDB(options){var cmd=options.cmd||"browse",path=options.path||"",browsemode=options.browsemode||"file",uplevel=options.uplevel||"",plugin=options.plugin||"",querytype=options.querytype||"",args=options.args||"";loadingSpinner("db");GUI.browsemode=browsemode;if(plugin!==""){if(plugin==="Spotify"){$.post("/db/?cmd=spotify",{plid:args},function(data){populateDB({data:data,path:path,plugin:plugin,querytype:querytype,uplevel:uplevel,args:args})},"json")}else if(plugin==="Dirble"){if(querytype==="childs"){$.post("/db/?cmd=dirble",{querytype:"childs",args:args},function(data){populateDB({data:data,path:path,plugin:plugin,querytype:"childs",uplevel:uplevel})},"json");$.post("/db/?cmd=dirble",{querytype:"childs-stations",args:args},function(data){populateDB({data:data,path:path,plugin:plugin,querytype:"childs-stations",uplevel:uplevel})},"json")}else{$.post("/db/?cmd=dirble",{querytype:querytype===""?"categories":querytype,args:args},function(data){populateDB({data:data,path:path,plugin:plugin,querytype:querytype,uplevel:uplevel})},"json")}}else if(plugin==="Jamendo"){$.post("/db/?cmd=jamendo",{querytype:querytype===""?"radio":querytype,args:args},function(data){populateDB({data:data.results,path:path,plugin:plugin,querytype:querytype})},"json")}}else{if(cmd==="search"){var keyword=$("#db-search-keyword").val();if(path.match(/Dirble/)){$.post("/db/?cmd=dirble",{querytype:"search",args:keyword},function(data){populateDB({data:data,path:path,plugin:"Dirble",querytype:"search",uplevel:uplevel})},"json")}else{$.post("/db/?querytype="+GUI.browsemode+"&cmd=search",{query:keyword},function(data){populateDB({data:data,path:path,uplevel:uplevel,keyword:keyword})},"json")}}else if(cmd==="browse"){$.post("/db/?cmd=browse",{path:path,browsemode:GUI.browsemode},function(data){populateDB({data:data,path:path,uplevel:uplevel})},"json")}else{loadingSpinner("db","hide");$.post("/db/?cmd="+cmd,{path:path,querytype:querytype},function(path){},"json")}}}function libraryHome(text){GUI.libraryhome=text[0];if(GUI.libraryhome.clientUUID===GUI.clientUUID&&GUI.plugin!=="Dirble"&&GUI.currentpath!=="Webradio"){renderLibraryHome()}if(GUI.currentpath==="Webradio"){getDB({path:"Webradio",uplevel:0})}if(GUI.forceGUIupdate===true){GUI.forceGUIupdate=false;renderLibraryHome()}}function listWLANs(text){var i=0,content="",inrange="",stored="",wlans=text[0];$.each(wlans,function(i){content+='<p><a href="/network/wlan/'+wlans[i].nic+"/"+wlans[i].ESSID+'" class="btn btn-lg btn-default btn-block" title="See network properties">';if(wlans[i].connected!==0){content+='<i class="fa fa-check green sx"></i>'}if(wlans[i].storedprofile===1&&wlans[i].encryption==="on"){content+='<i class="fa fa-lock sx"></i>'}else{if(wlans[i].encryption==="on"){content+='<i class="fa fa-rss fa-wifi"></i><i class="fa fa-lock sx"></i>'}else{if(wlans[i].storedprofile!==1){content+='<i class="fa fa-rss fa-wifi sx"></i>'}}}content+="<strong>"+wlans[i].ESSID+"</strong></a></p>";if(wlans[i].origin==="scan"){inrange+=content}if(wlans[i].storedprofile===1){stored+=content}content=""});if(inrange===""){inrange='<p><a class="btn btn-lg btn-default btn-block" href="#"><i class="fa fa-cog fa-spin sx"></i>scanning for networks...</a></p>'}document.getElementById("wifiNetworks").innerHTML=inrange;document.getElementById("wifiStored").innerHTML=stored;$.ajax({url:"/command/?cmd=wifiscan",cache:false})}function nicsDetails(text){var i=0,content="",nics=text[0];$.each(nics,function(i){if(i===$("#nic-details").data("name")){content+="<tr><th>Name:</th><td><strong>"+i+"<strong></td></tr>";content+="<tr><th>Type:</th><td>wireless</td></tr>";if(nics[i].currentssid===null){content+='<tr><th>Status:</th><td><i class="fa fa-times red sx"></i>no network connected</td></tr>'}else{content+='<tr><th>Status:</th><td><i class="fa fa-check green sx"></i>connected</td></tr>';content+="<tr><th>Associated SSID:</th><td><strong>"+nics[i].currentssid+"</strong></td></tr>"}content+="<tr><th>Assigned IP:</th><td>"+(nics[i].ip!==null?"<strong>"+nics[i].ip+"</strong>":"none")+"</td></tr>";content+="<tr><th>Speed:</th><td>"+(nics[i].speed!==null?nics[i].speed:"unknown")+"</td></tr>";if(nics[i].currentssid!==null){content+="<tr><th>Netmask:</th><td>"+nics[i].netmask+"</td></tr>";content+="<tr><th>Gateway:</th><td>"+nics[i].gw+"</td></tr>";content+="<tr><th>DNS1:</th><td>"+nics[i].dns1+"</td></tr>";content+="<tr><th>DNS2:</th><td>"+nics[i].dns2+"</td></tr>"}}});$("#nic-details tbody").html(content)}function playbackChannel(){var pushstream=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode,reconnectOnChannelUnavailableInterval:5e3});pushstream.onmessage=renderUI;pushstream.onstatuschange=function(status){if(status===2){$("#loader").addClass("hide");sendCmd("renderui")}else{if(status===0){toggleLoader()}}};pushstream.addChannel("playback");pushstream.connect()}function queueChannel(){var pushstream=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});pushstream.onmessage=getPlaylist;pushstream.addChannel("queue");pushstream.connect()}function libraryChannel(){var pushstream=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});pushstream.onmessage=libraryHome;pushstream.addChannel("library");pushstream.connect()}function notifyChannel(){var pushstream=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});pushstream.onmessage=renderMSG;pushstream.addChannel("notify");pushstream.connect()}function wlansChannel(){var pushstream=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});pushstream.onmessage=listWLANs;pushstream.addChannel("wlans");pushstream.connect();$.ajax({url:"/command/?cmd=wifiscan",cache:false})}function nicsChannel(){var pushstream=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});pushstream.onmessage=nicsDetails;pushstream.addChannel("nics");pushstream.connect()}function overlayTrigger(overlayID){var overlay=$(overlayID),triggerBttn=$(overlayID+"-open"),closeBttn=$(overlayID+"-close");transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};function toggleOverlay(){if(overlay.hasClass("open")){overlay.removeClass("open");overlay.addClass("closed");var onEndTransitionFn=function(ev){if(support.transitions){if(ev.propertyName!=="visibility"){return}this.removeEventListener(transEndEventName,onEndTransitionFn)}overlay.removeClass("closed")}}else if(overlay.hasClass("closed")){overlay.addClass("open");if(overlayID==="#overlay-social"){var urlTwitter="https://twitter.com/home?status=Listening+to+"+GUI.json.currentsong.replace(/\s+/g,"+")+"+by+"+GUI.json.currentartist.replace(/\s+/g,"+")+"+on+%40RuneAudio+http%3A%2F%2Fwww.runeaudio.com%2F+%23nowplaying";var urlFacebook="https://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.runeaudio.com%2F&display=popup";var urlGooglePlus="https://plus.google.com/share?url=http%3A%2F%2Fwww.runeaudio.com%2F";$("#urlTwitter").attr("href",urlTwitter);$("#urlFacebook").attr("href",urlFacebook);$("#urlGooglePlus").attr("href",urlGooglePlus)}}}triggerBttn.click(function(){toggleOverlay()});closeBttn.click(function(){toggleOverlay()})}function getHiddenProp(){var prefixes=["webkit","moz","ms","o"];if("hidden"in document){return"hidden"}for(var i=0;i<prefixes.length;i++){if(prefixes[i]+"Hidden"in document){return prefixes[i]+"Hidden"}}return null}function isHidden(){var prop=getHiddenProp();if(!prop){return false}return document[prop]}function visChange(){if(isHidden()){GUI.visibility="hidden"}else{GUI.visibility="visible"}}if($("#section-index").length){jQuery(document).ready(function($){"use strict";GUI.mode=checkWebSocket();playbackChannel();libraryChannel();PNotify.prototype.options.styling="fontawesome";PNotify.prototype.options.stack.dir1="up";PNotify.prototype.options.stack.dir2="left";PNotify.prototype.options.stack.firstpos1=90;PNotify.prototype.options.stack.firstpos2=50;PNotify.prototype.options.stack.spacing1=10;PNotify.prototype.options.stack.spacing2=10;notifyChannel();var visProp=getHiddenProp();if(visProp){var evtname=visProp.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(evtname,visChange)}$(".btn-cmd").click(function(){var el=$(this);commandButton(el)});$("#random").click(function(){if($("#random").attr("data-cmd")==="pl-ashuffle-stop"){$.post("/db/?cmd=pl-ashuffle-stop","");$("#random").attr("data-cmd","random");$("#random").attr("title","Random");$("#random").removeClass("btn-primary")}});var playlist=$("#playlist-entries");playlist.on("click","li",function(e){var cmd="";if($(e.target).hasClass("pl-action")){e.preventDefault();var id=$(this).attr("id");id=parseInt(id.replace("pl-",""));cmd="deleteid "+id;sendCmd(cmd)}else{var pos=$("li","#playlist-entries").index(this);cmd="play "+pos;sendCmd(cmd);$("li.active","#playlist-entries").removeClass("active");$(this).addClass("active")}});$("a","#open-panel-dx").click(function(){if($("#open-panel-dx").hasClass("active")){var current=parseInt(GUI.json.song);customScroll("pl",current,500);if(!$("#pl-filter-results").hasClass("hide"))$("#pl-filter-results").click()}}).on("shown.bs.tab",function(e){var current=parseInt(GUI.json.song);customScroll("pl",current,0)});$("#open-library").click(function(){$("#open-panel-dx").removeClass("active");$("#open-panel-sx").addClass("active")});$("#pl-filter").keyup(function(){$.scrollTo(0,500);var filter=$(this).val(),count=0;$("li","#playlist-entries").each(function(){var el=$(this);if(el.text().search(new RegExp(filter,"i"))<0){el.hide()}else{el.show();count++}});var numberItems=count;var s=count===1?"":"s";if(filter!==""){$("#pl-count").addClass("hide");$("#pl-filter-results").removeClass("hide").html('<i class="fa fa-times sx"></i><span class="visible-xs-inline">back</span><span class="hidden-xs">'+ +count+" result"+s+' for "<span class="keyword">'+filter+'</span>"</span>')}else{$("#pl-count").removeClass("hide");$("#pl-filter-results").addClass("hide").html("")}});$("#pl-filter-results").click(function(){$(this).addClass("hide");$("#pl-count").removeClass("hide");if($(this).hasClass("back-to-queue")){$(".playlist").addClass("hide");getPlaylistCmd();$("#pl-currentpath").addClass("hide");$("#pl-manage").removeClass("hide")}else{$("li","#playlist-entries").each(function(){var el=$(this);el.show()});$("#pl-currentpath").removeClass("hide");$("#pl-filter").val("")}customScroll("pl",parseInt(GUI.json.song),500)});$("#pl-manage-list").click(function(){getPlaylists()});$("#modal-pl-save-btn").click(function(){var playlistname=$("#pl-save-name").val();sendCmd('save "'+playlistname+'"')});$("#pl-editor").on("click",".pl-action",function(e){e.preventDefault();var path=$(this).parent().attr("data-path");GUI.DBentry[0]=path});$("#pl-rename-button").click(function(){var oldname=$("#pl-rename-oldname").text();var newname=$("#pl-rename-name").val();sendCmd('rename "'+oldname+'" "'+newname+'"');getPlaylists()});$("#pl-manage-save").click(function(){getPlaylistsDropdown()});var sortlist=document.getElementById("playlist-entries");new Sortable(sortlist,{ghostClass:"sortable-ghost",onUpdate:function(evt){sortOrder(evt.item.getAttribute("id"))}});$("a","#open-panel-sx").click(function(){if($("#open-panel-sx").hasClass("active")){customScroll("pl",parseInt(GUI.json.song),500)}}).on("shown.bs.tab",function(e){customScroll("db",GUI.currentDBpos[GUI.currentDBpos[10]],0)});$("#home-blocks").on("click",".home-block",function(e){if(!$(this).hasClass("inactive")){if($(this).is("#home-spotify-switch")){$("#overlay-playsource-open").trigger("click")}else if($(e.target).is("span.block-remove")){var bookmarkID=$(this).attr("id");bookmarkID=bookmarkID.replace("home-bookmark-","");var bookmarkName=$(this).find("h3").text();$.post("/db/?cmd=bookmark",{id:bookmarkID,name:bookmarkName})}else{++GUI.currentDBpos[10];getDB({browsemode:$(this).data("browsemode"),path:$(this).data("path"),uplevel:0,plugin:$(this).data("plugin")})}}else{$("#overlay-playsource-open").trigger("click")}});$("#db-homeSetup").click(function(){var editbtn=$(this);if(editbtn.hasClass("btn-primary")){editbtn.removeClass("btn-primary").addClass("btn-default");$(".home-block-remove").remove()}else{editbtn.removeClass("btn-default").addClass("btn-primary");$(".home-block.home-bookmark").append('<div class="home-block-remove" title="Remove this bookmark"><span class="block-remove">&times;</span></div>')}});var db=$("#database-entries");db.on("click","li",function(e){var path="",browsemode="";var el=$(this);if($(e.target).hasClass("db-action")){e.preventDefault();if(el.data("type")==="spotify-track"){path=el.data("plid")+"-"+el.data("path")}else{path=el.data("path")}GUI.DBentry[0]=path}else{$("li.active","#database-entries").removeClass("active");el.addClass("active");if(el.hasClass("db-folder")){path=el.data("path");if(el.hasClass("db-album")){if(path!==""){getDB({path:path,uplevel:0,browsemode:"album"})}else{path=GUI.currentDBpath[GUI.currentDBpos[10]-1];getDB({path:path,uplevel:0,browsemode:"albumfilter"})}}else if(el.hasClass("db-artist")){getDB({path:path,uplevel:0,browsemode:"artist"})}else if(el.hasClass("db-composer")){getDB({path:path,uplevel:0,browsemode:"composer"})}else if(el.hasClass("db-genre")){getDB({path:path,uplevel:0,browsemode:"genre"})}else if(el.hasClass("db-spotify")){path=GUI.currentpath+"/"+el.find("span").text();getDB({path:path,plugin:"Spotify",args:el.data("path").toString(),querytype:"tracks"});GUI.plugin="Spotify"}else if(el.hasClass("db-dirble")){path=GUI.currentpath+"/"+el.find("span").text();var querytype=el.hasClass("db-dirble-child")?"stations":"childs";getDB({path:path,plugin:"Dirble",querytype:querytype,args:el.data("path")});GUI.plugin="Dirble"}else if(el.hasClass("db-jamendo")){}else{browsemode=el.data("browsemode");getDB({path:path,uplevel:0,browsemode:browsemode})}var entryID=el.attr("id");entryID=entryID.replace("db-","");GUI.currentDBpos[GUI.currentDBpos[10]]=entryID;GUI.currentDBpath[GUI.currentDBpos[10]]=path;++GUI.currentDBpos[10]}else if(el.hasClass("db-webradio-add")){$("#modal-webradio-add").modal()}}});db.on("dblclick","li",function(e){var el=$(this);if(!$(e.target).hasClass("db-action")){$("li.active","#database-entries").removeClass("active");el.addClass("active");var path=el.data("path");if(el.hasClass("db-spotify")){path=el.attr("data-plid")+"-"+el.attr("data-path");getDB({cmd:"spaddplay",path:path,querytype:"spotify-track"})}else{path=el.hasClass("db-dirble")?path.split(" | ")[1]:path;getDB({cmd:"addplay",path:path})}}});$("#db-level-up").click(function(){--GUI.currentDBpos[10];var path=GUI.currentpath;if(GUI.currentDBpos[10]===0){path=""}else{if(GUI.browsemode==="file"){var cutpos=path.lastIndexOf("/");path=cutpos!==-1?path.slice(0,cutpos):""}else{if(GUI.browsemode==="album"){path=GUI.currentDBpath[GUI.currentDBpos[10]-1];if(path===""){path="Albums"}else{GUI.browsemode="artist"}}else if(GUI.browsemode==="artist"){path=GUI.currentDBpath[GUI.currentDBpos[10]-1];if(path===""){path="Artists"}else{GUI.browsemode="genre"}}else if(GUI.browsemode==="composer"){path=GUI.currentDBpath[GUI.currentDBpos[10]-1];if(path===""){path="Composer"}else{GUI.browsemode="artist"}}else if(GUI.browsemode==="genre"){path="Genres"}else if(GUI.browsemode==="albumfilter"){GUI.browsemode="artist";path=GUI.currentDBpath[GUI.currentDBpos[10]-1]}}}getDB({browsemode:GUI.browsemode,path:path,plugin:GUI.plugin,uplevel:1});GUI.plugin=""});$("#db-search-results").click(function(){$(this).addClass("hide");$("#db-level-up").removeClass("hide");getDB({path:GUI.currentpath})});$("a",".context-menu").click(function(){var dataCmd=$(this).data("cmd");var dataType=$(this).data("type");var path=GUI.DBentry[0];GUI.DBentry[0]="";switch(dataCmd){case"pl-add":sendCmd('load "'+path+'"');break;case"pl-replace":sendCmd("clear");sendCmd('load "'+path+'"');break;case"pl-addreplaceplay":sendCmd("clear");sendCmd('load "'+path+'"');sendCmd("play");break;case"pl-rename":$("#modal-pl-rename").modal();$("#pl-rename-oldname").text(path);break;case"pl-rm":$.ajax({url:"/command/?cmd=rm%20%22"+path+"%22",success:function(data){getPlaylists(data)},cache:false});break;case"pl-ashuffle":$.post("/db/?cmd=pl-ashuffle",{playlist:path});$("#random").attr("data-cmd","pl-ashuffle-stop");$("#random").attr("title","Stop randomly adding songs");$("#random").addClass("btn-primary");break;case"wradd":path=path.split(" | ")[1];getDB({cmd:"add",path:path});break;case"wraddplay":path=path.split(" | ")[1];getDB({cmd:"addplay",path:path});break;case"wraddreplaceplay":path=path.split(" | ")[1];getDB({cmd:"addreplaceplay",path:path});break;case"wredit":$("#modal-webradio-edit").modal();$.post("/db/?cmd=readradio",{filename:path},function(data){var name=$("#webradio-edit-name");name.val(data.name);name.data("file-name",data.name);$("#webradio-edit-url").val(data.url)},"json");break;case"wrdelete":$("#modal-webradio-delete").modal();$("#webradio-delete-name").text(path.replace("Webradio/",""));break;case"wrsave":var parameters=path.split(" | ");$.post("/db/?cmd=addradio",{"radio[label]":parameters[0],"radio[url]":parameters[1]});break;default:getDB({cmd:dataCmd,path:path,browsemode:GUI.browsemode,querytype:dataType});break}});$("#webradio-add-button").click(function(){var radioname=$("#webradio-add-name").val();var radiourl=$("#webradio-add-url").val();if(radioname===""||radiourl===""){renderMSG([{title:"Missing fields",text:"Please fill both fields to continue",icon:"fa fa-warning"}])}else{$.post("/db/?cmd=addradio",{"radio[label]":radioname,"radio[url]":radiourl},function(data){},"json");$("#modal-webradio-add").modal("hide");$("#webradio-add-name").val("");$("#webradio-add-url").val("")}});$("#webradio-edit-button").click(function(){var name=$("#webradio-edit-name");$.post("/db/?cmd=editradio",{"radio[newlabel]":name.val(),"radio[label]":name.data("file-name"),"radio[url]":$("#webradio-edit-url").val()},function(data){},"json")});$("#webradio-delete-button").click(function(){var radioname=$("#webradio-delete-name").text();$.post("/db/?cmd=deleteradio",{"radio[label]":radioname},function(data){},"json")});$("#db-firstPage").click(function(){$.scrollTo(0,500)});$("#db-prevPage").click(function(){var scrolloffset="-="+$(window).height()+"px";$.scrollTo(scrolloffset,500)});$("#db-nextPage").click(function(){var scrolloffset="+="+$(window).height()+"px";$.scrollTo(scrolloffset,500)});$("#db-lastPage").click(function(){$.scrollTo("100%",500)});$("#pl-firstPage").click(function(){$.scrollTo(0,500)});$("#pl-prevPage").click(function(){var scrollTop=$(window).scrollTop();var scrolloffset=scrollTop-$(window).height();$.scrollTo(scrolloffset,500)});$("#pl-nextPage").click(function(){var scrollTop=$(window).scrollTop();var scrolloffset=scrollTop+$(window).height();$.scrollTo(scrolloffset,500)});$("#pl-lastPage").click(function(){$.scrollTo("100%",500)});var url=document.location.toString();if(url.match("#")){$('#menu-bottom a[href="/#'+url.split("#")[1]+'"]').tab("show")}$("#menu-bottom a").on("shown",function(e){if(history.pushState){history.pushState(null,null,e.target.hash)}else{window.location.hash=e.target.hash}}).on("click",function(){if($("#overlay-social").hasClass("open")){$(".overlay-close").trigger("click")}});if($(".ttip").length){$(".ttip").tooltip()}FastClick.attach(document.body);$("#syscmd-poweroff").click(function(){$.post("/settings/",{syscmd:"poweroff"});toggleLoader()});$("#syscmd-reboot").click(function(){$.post("/settings/",{syscmd:"reboot"});toggleLoader()});$("#syscmd-display_off").click(function(){$.post("/settings/",{syscmd:"display_off"})});overlayTrigger("#overlay-social");overlayTrigger("#overlay-playsource");$("#playsource-mpd").click(function(){if($(this).hasClass("inactive")){GUI.forceGUIupdate=true;$.ajax({url:"/command/?switchplayer=MPD",cache:false});$("#overlay-playsource-close").trigger("click")}});$("#playsource-spotify").click(function(){if($(this).hasClass("inactive")){if(GUI.libraryhome.Spotify==="1"){GUI.forceGUIupdate=true;$.ajax({url:"/command/?switchplayer=Spotify",cache:false});$("#overlay-playsource-close").trigger("click")}else{new PNotify({title:"Spotify not enabled",text:"Enable and configure it under the Settings screen",icon:"fa fa-exclamation-circle"})}}});if(document.location.hostname=="localhost")$(".osk-trigger").onScreenKeyboard({draggable:true})})}else{jQuery(document).ready(function($){"use strict";GUI.mode=checkWebSocket();playbackChannel();PNotify.prototype.options.styling="fontawesome";PNotify.prototype.options.stack.dir1="up";PNotify.prototype.options.stack.dir2="left";PNotify.prototype.options.stack.firstpos1=90;PNotify.prototype.options.stack.firstpos2=50;PNotify.prototype.options.stack.spacing1=10;PNotify.prototype.options.stack.spacing2=10;notifyChannel();$(".btn-cmd").click(function(){var el=$(this);commandButton(el)});$("#syscmd-poweroff").click(function(){$.post("/settings/",{syscmd:"poweroff"});toggleLoader()});$("#syscmd-reboot").click(function(){$.post("/settings/",{syscmd:"reboot"});toggleLoader()});$("#syscmd-display_off").click(function(){$.post("/settings/",{syscmd:"display_off"})});$(".selectpicker").selectpicker();if($("#section-sources").length){if($("#mount-type").val()==="nfs"){$("#mount-cifs").addClass("disabled").children(".disabler").removeClass("hide")}$("#mount-type").change(function(){if($(this).val()==="cifs"||$(this).val()==="osx"){$("#mount-cifs").removeClass("disabled").children(".disabler").addClass("hide")}else{$("#mount-cifs").addClass("disabled").children(".disabler").removeClass("hide")}});$("#nas-guest").change(function(){if($(this).prop("checked")){$("#mount-auth").addClass("disabled").children(".disabler").removeClass("hide")}else{$("#mount-auth").removeClass("disabled").children(".disabler").addClass("hide")}});$("#nas-advanced").change(function(){if($(this).prop("checked")){$("#mount-advanced-config").removeClass("hide")}else{$("#mount-advanced-config").addClass("hide")}});$("#show-mount-advanced-config").click(function(e){e.preventDefault();if($(this).hasClass("active")){$("#mount-advanced-config").toggleClass("hide");$(this).removeClass("active");$(this).find("i").removeClass("fa fa-minus-circle").addClass("fa fa-plus-circle");$(this).find("span").html("show advanced options")}else{$("#mount-advanced-config").toggleClass("hide");$(this).addClass("active");$(this).find("i").removeClass("fa fa-plus-circle").addClass("fa fa-minus-circle");$(this).find("span").html("hide advanced options")}});$("#usb-mount-list a").click(function(){var mountName=$(this).data("mount");$("#usb-umount-name").html(mountName);$("#usb-umount").val(mountName)})}if($("#section-settings").length){$("#airplay").change(function(){if($(this).prop("checked")){$("#airplayName").removeClass("hide");$("#airplayBox").addClass("boxed-group")}else{$("#airplayName").addClass("hide");$("#airplayBox").removeClass("boxed-group")}});$("#scrobbling-lastfm").change(function(){if($(this).prop("checked")){$("#lastfmAuth").removeClass("hide");$("#lastfmBox").addClass("boxed-group")}else{$("#lastfmAuth").addClass("hide");$("#lastfmBox").removeClass("boxed-group")}});$("#proxy").change(function(){if($(this).prop("checked")){$("#proxyAuth").removeClass("hide");$("#proxyBox").addClass("boxed-group")}else{$("#proxyAuth").addClass("hide");$("#proxyBox").removeClass("boxed-group")}});$("#dlna").change(function(){if($(this).prop("checked")){$("#dlnaName").removeClass("hide");$("#dlnaBox").addClass("boxed-group")}else{$("#dlnaName").addClass("hide");$("#dlnaBox").removeClass("boxed-group")}});$("#spotify").change(function(){if($(this).prop("checked")){$("#spotifyAuth").removeClass("hide");$("#spotifyBox").addClass("boxed-group")}else{$("#spotifyAuth").addClass("hide");$("#spotifyBox").removeClass("boxed-group")}});$(".btn-file :file").on("fileselect",function(event,numFiles,label){var input=$(this).parents(".input-group").find(":text");if(input.length){input.val(label)}else{if(label){console.log("Selected file: ",label);if(label.indexOf("backup_")>-1&&label.indexOf(".tar.gz")>-1){$("#backup-file").html(' <i class="fa fa-check dx green"></i> '+label+"");$("#btn-backup-upload").prop("disabled",false)}else{$("#backup-file").html(' <i class="fa fa-times dx red"></i> not a valid backup file');$("#btn-backup-upload").prop("disabled",true)}}}})}if($("#section-network").length){var netManualConf=$("#network-manual-config");if($("#dhcp").val()==="0"){netManualConf.removeClass("hide")}$("#dhcp").change(function(){if($(this).val()==="0"){netManualConf.removeClass("hide")}else{netManualConf.addClass("hide")}});var WiFiKey=$("#wifi-security-key");if($("#wifi-security").val()!=="open"){WiFiKey.removeClass("hide")}$("#wifi-security").change(function(){if($(this).val()!=="open"){WiFiKey.removeClass("hide")}else{WiFiKey.addClass("hide")}});if($("#wifiNetworks").length){wlansChannel();nicsChannel()}$("#wifiProfiles").change(function(){if($(this).prop("checked")){$("#wifiProfilesBox").addClass("hide")}else{$("#wifiProfilesBox").removeClass("hide")}})}if($("#section-accesspoint").length){$("#accesspoint").change(function(){if($(this).prop("checked")){$("#accesspointSettings").removeClass("hide");$("#accesspointBox").addClass("boxed-group")}else{$("#accesspointSettings").addClass("hide");$("#accesspointBox").removeClass("boxed-group")}});$("#ip-address").change(function(){var parts=$("#ip-address").val().split(".");parts[3]++;$("#dhcp-range").val(parts.join(".")+","+parts[0]+"."+parts[1]+"."+parts[2]+".254,24h");parts[3]=255;$("#broadcast").val(parts.join("."));$("#dhcp-option-dns").val($("#ip-address").val());$("#dhcp-option-router").val($("#ip-address").val())})}if($("#section-mpd").length){$("#audio-output-interface").change(function(){renderMSG([{title:"Switching audio output",text:"Please wait for the config update...",icon:"fa fa-cog fa-spin",delay:5e3}]);var output=$(this).val();$.ajax({type:"POST",url:"/mpd/",data:{ao:output},cache:false})});$(".manual-edit-confirm").find(".btn-primary").click(function(){$("#mpdconf_editor").removeClass("hide");$("#manual-edit-warning").addClass("hide")})}if($("#section-debug").length){ZeroClipboard.config({swfPath:"/assets/js/vendor/ZeroClipboard.swf"});var client=new ZeroClipboard(document.getElementById("copy-to-clipboard"));client.on("ready",function(readyEvent){client.on("aftercopy",function(event){new PNotify({title:"Copied to clipboard",text:"The debug output was copied successfully in your clipboard.",icon:"fa fa-check"})})})}if(document.location.hostname=="localhost")$(".osk-trigger").onScreenKeyboard({draggable:true})});$(document).on("change",".btn-file :file",function(){var input=$(this),numFiles=input.get(0).files?input.get(0).files.length:1,label=input.val().replace(/\\/g,"/").replace(/.*\//,"");input.trigger("fileselect",[numFiles,label])})}