var GUI={DBentry:["","",""],DBupdate:0,activePlayer:"",browsemode:"file",checkvol:0,currentDBpos:[0,0,0,0,0,0,0,0,0,0,0],currentDBpath:["","","","","","","","","","",""],currentalbum:null,currentknob:null,currentpath:"",currentsong:null,json:0,libraryhome:"",forceGUIupdate:false,maxvol:100,minvol:0,mode:"websocket",noticeUI:{},playlist:null,plugin:"",state:"",old_state:"none",stepVolumeDelta:0,stepVolumeInt:0,stream:"",visibility:"visible",vol_changed_local:0,volume:null,clientUUID:null};PNotify.prototype.options.styling="fontawesome";PNotify.prototype.options.stack.dir1="up";PNotify.prototype.options.stack.dir2="left";PNotify.prototype.options.stack.firstpos1=90;PNotify.prototype.options.stack.firstpos2=50;PNotify.prototype.options.stack.spacing1=10;PNotify.prototype.options.stack.spacing2=10;GUI.mode=checkWebSocket();var pushstreamnofify=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});pushstreamnofify.onmessage=renderMSG;pushstreamnofify.addChannel("notify");pushstreamnofify.connect();if(document.location.hostname==="localhost"){$(".osk-trigger").onScreenKeyboard({draggable:true})}function generateUUID(){var b=new Date().getTime();var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var d=(b+Math.random()*16)%16|0;b=Math.floor(b/16);return(e=="x"?d:(d&3|8)).toString(16)});return a}function sendCmd(a){$.ajax({type:"GET",url:"/command/?cmd="+a+"&clientUUID="+GUI.clientUUID,cache:false})}function checkWebSocket(){if(window.WebSocket){return"websocket"}else{return"longpolling"}}function parsePath(c){var a=c&&c.length?c.lastIndexOf("/"):0;var b="";if(a&&a!==-1){b=c.slice(0,a)}return b}$(document).ready(function(){GUI.clientUUID=generateUUID()});function customNotify(a){if(a.custom==="kernelswitch"){if(GUI.noticeUI.kernelswitch!==undefined){GUI.noticeUI.kernelswitch.remove()}GUI.noticeUI.kernelswitch=new PNotify({title:("title" in a)?a.title:"[missing title]",text:("text" in a)?a.text:"[missing text]",icon:"fa fa-refresh",hide:false,confirm:{confirm:true,buttons:[{text:a.btntext,addClass:"btn-default btn-block  uppercase",click:function(){$.post("/settings/",{syscmd:"reboot"});$("#loader").removeClass("hide")}},{text:"Cancel",addClass:"hide"}]},buttons:{closer:false,sticker:false}})}}function renderMSG(c){var b=c[0];if("custom" in b&&b.custom!==null){customNotify(b);return}var a={title:("title" in b)?b.title:"[missing title]",text:("text" in b)?b.text:"[missing text]",icon:(b.icon===undefined)?"fa fa-check":b.icon,opacity:(b.opacity===undefined)?0.9:b.opacity,hide:(b.hide===undefined&&b.permanotice===undefined),buttons:{closer:(b.permanotice===undefined),sticker:(b.permanotice===undefined)},delay:(b.delay===undefined)?8000:b.delay,mouse_reset:false};if("permanotice" in b){if(GUI.noticeUI[b.permanotice]===undefined){GUI.noticeUI[b.permanotice]=new PNotify(a)}else{if("permaremove" in b){GUI.noticeUI[b.permanotice].remove();GUI.noticeUI[b.permanotice]=undefined}else{GUI.noticeUI[b.permanotice].open()}}}else{new PNotify(a)}}function loadingSpinner(b,a){if(a==="hide"){if(b==="db"){$("#spinner-db").addClass("hide")}if(b==="pl"){$("#spinner-pl").addClass("hide")}}else{if(b==="db"){$("#spinner-db").removeClass("hide")}if(b==="pl"){$("#spinner-pl").removeClass("hide")}}}function setPlaybackSource(){var a=GUI.libraryhome.ActivePlayer;$("#overlay-playsource-open button").text(a);$("#overlay-playsource a").addClass("inactive");var b=a.toLowerCase();$("#playsource-"+b).removeClass("inactive");if(a==="Spotify"||a==="Airplay"){$("#volume").trigger("configure",{readOnly:true,fgColor:"#1A242F"}).css({color:"#1A242F"});$("#volume-knob").addClass("nomixer");$("#volume-knob button").prop("disabled",true);$("#single").addClass("disabled")}else{$("#volume").trigger("configure",{readOnly:false,fgColor:"#0095D8"}).css({color:"#0095D8"});$("#volume-knob").removeClass("nomixer");$("#volume-knob button").prop("disabled",false);$("#single").removeClass("disabled")}$("#playlist-entries").removeClass(function(c,d){return(d.match(/(^|\s)playlist-\S+/g)||[]).join(" ")}).addClass("playlist-"+b);$("#pl-manage").removeClass(function(c,d){return(d.match(/(^|\s)pl-manage-\S+/g)||[]).join(" ")}).addClass("pl-manage-"+b)}function getPlaylist(a){data=a[0];if(data.length>4){$(".playlist").addClass("hide");$("#playlist-entries").removeClass("hide");getPlaylistPlain(data)}else{$(".playlist").addClass("hide");$("#playlist-warning").removeClass("hide");$("#pl-filter-results").addClass("hide").html("");$("#pl-count").removeClass("hide").html("0 entries")}loadingSpinner("pl","hide")}function renderPlaylists(e){var d="",g="";var c,b,a=e.split("\n"),f=[];for(c=0;(b=a[c]);c+=1){f=b.split(": ");if("playlist"===f[0]){g=f[1];d+='<li class="pl-folder" data-path="'+g+'"><i class="fa fa-bars pl-action" data-target="#context-menu-playlist" data-toggle="context" title="Actions"></i><span><i class="fa fa-list-ol"></i>'+g+"</span></li>";g=""}}document.getElementById("playlist-entries").innerHTML="";$(".playlist").addClass("hide");$("#pl-manage").addClass("hide");$("#pl-count").addClass("hide");$("#pl-filter-results").removeClass("hide").addClass("back-to-queue").html('<i class="fa fa-arrow-left sx"></i> to queue');$("#pl-currentpath").removeClass("hide");$("#pl-editor").removeClass("hide");document.getElementById("pl-editor").innerHTML=d;loadingSpinner("pl","hide")}function getPlaylists(){loadingSpinner("pl");$.ajax({url:"/command/?cmd=listplaylists",success:function(a){renderPlaylists(a)},cache:false})}function getDB(i){var b=i.cmd||"browse",h=i.path||"",a=i.browsemode||"file",f=i.uplevel||"",c=i.plugin||"",g=i.querytype||"",e=i.args||"";loadingSpinner("db");GUI.browsemode=a;if(c!==""){if(c==="Spotify"){$.post("/db/?cmd=spotify",{plid:e},function(j){populateDB({data:j,path:h,plugin:c,querytype:g,uplevel:f,args:e})},"json")}else{if(c==="Dirble"){if(g==="childs"){$.post("/db/?cmd=dirble",{querytype:"childs",args:e},function(j){populateDB({data:j,path:h,plugin:c,querytype:"childs",uplevel:f})},"json");$.post("/db/?cmd=dirble",{querytype:"childs-stations",args:e},function(j){populateDB({data:j,path:h,plugin:c,querytype:"childs-stations",uplevel:f})},"json")}else{$.post("/db/?cmd=dirble",{querytype:(g==="")?"categories":g,args:e},function(j){populateDB({data:j,path:h,plugin:c,querytype:g,uplevel:f})},"json")}}else{if(c==="Jamendo"){$.post("/db/?cmd=jamendo",{querytype:(g==="")?"radio":g,args:e},function(j){populateDB({data:j.results,path:h,plugin:c,querytype:g})},"json")}}}}else{if(b==="search"){var d=$("#db-search-keyword").val();if(h.match(/Dirble/)){$.post("/db/?cmd=dirble",{querytype:"search",args:d},function(j){populateDB({data:j,path:h,plugin:"Dirble",querytype:"search",uplevel:f})},"json")}else{$.post("/db/?querytype="+GUI.browsemode+"&cmd=search",{query:d},function(j){populateDB({data:j,path:h,uplevel:f,keyword:d})},"json")}}else{if(b==="browse"){$.post("/db/?cmd=browse",{path:h,browsemode:GUI.browsemode},function(j){populateDB({data:j,path:h,uplevel:f})},"json")}else{loadingSpinner("db","hide");$.post("/db/?cmd="+b,{path:h,querytype:g},function(j){},"json")}}}}function libraryHome(a){GUI.libraryhome=a[0];if(GUI.libraryhome.clientUUID===GUI.clientUUID&&GUI.plugin!=="Dirble"&&GUI.currentpath!=="Webradio"){renderLibraryHome()}if(GUI.currentpath==="Webradio"){getDB({path:"Webradio",uplevel:0})}if(GUI.forceGUIupdate===true){GUI.forceGUIupdate=false;renderLibraryHome()}}function listWLANs(f){var b=0,d="",a="",c="",e=f[0];$.each(e,function(g){d+='<p><a href="/network/wlan/'+e[g].nic+"/"+e[g].ESSID+'" class="btn btn-lg btn-default btn-block" title="See network properties">';if(e[g].connected!==0){d+='<i class="fa fa-check green sx"></i>'}if(e[g].storedprofile===1&&e[g].encryption==="on"){d+='<i class="fa fa-lock sx"></i>'}else{if(e[g].encryption==="on"){d+='<i class="fa fa-rss fa-wifi"></i><i class="fa fa-lock sx"></i>'}else{if(e[g].storedprofile!==1){d+='<i class="fa fa-rss fa-wifi sx"></i>'}}}d+="<strong>"+e[g].ESSID+"</strong></a></p>";if(e[g].origin==="scan"){a+=d}if(e[g].storedprofile===1){c+=d}d=""});if(a===""){a='<p><a class="btn btn-lg btn-default btn-block" href="#"><i class="fa fa-cog fa-spin sx"></i>scanning for networks...</a></p>'}document.getElementById("wifiNetworks").innerHTML=a;document.getElementById("wifiStored").innerHTML=c;$.ajax({url:"/command/?cmd=wifiscan",cache:false})}function nicsDetails(d){var b=0,c="",a=d[0];$.each(a,function(e){if(e===$("#nic-details").data("name")){c+="<tr><th>Name:</th><td><strong>"+e+"<strong></td></tr>";c+="<tr><th>Type:</th><td>wireless</td></tr>";if(a[e].currentssid===null){c+='<tr><th>Status:</th><td><i class="fa fa-times red sx"></i>no network connected</td></tr>'}else{c+='<tr><th>Status:</th><td><i class="fa fa-check green sx"></i>connected</td></tr>';c+="<tr><th>Associated SSID:</th><td><strong>"+a[e].currentssid+"</strong></td></tr>"}c+="<tr><th>Assigned IP:</th><td>"+((a[e].ip!==null)?("<strong>"+a[e].ip+"</strong>"):"none")+"</td></tr>";c+="<tr><th>Speed:</th><td>"+((a[e].speed!==null)?a[e].speed:"unknown")+"</td></tr>";if(a[e].currentssid!==null){c+="<tr><th>Netmask:</th><td>"+a[e].netmask+"</td></tr>";c+="<tr><th>Gateway:</th><td>"+a[e].gw+"</td></tr>";c+="<tr><th>DNS1:</th><td>"+a[e].dns1+"</td></tr>";c+="<tr><th>DNS2:</th><td>"+a[e].dns2+"</td></tr>"}}});$("#nic-details tbody").html(c)}function wlansChannel(){var a=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});a.onmessage=listWLANs;a.addChannel("wlans");a.connect();$.ajax({url:"/command/?cmd=wifiscan",cache:false})}function nicsChannel(){var a=new PushStream({host:window.location.hostname,port:window.location.port,modes:GUI.mode});a.onmessage=nicsDetails;a.addChannel("nics");a.connect()}function overlayTrigger(d){var c=$(d),e=$(d+"-open"),b=$(d+"-close");transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};function a(){if(c.hasClass("open")){c.removeClass("open");c.addClass("closed");var i=function(j){if(support.transitions){if(j.propertyName!=="visibility"){return}this.removeEventListener(transEndEventName,i)}c.removeClass("closed")}}else{if(c.hasClass("closed")){c.addClass("open");if(d==="#overlay-social"){var h="https://twitter.com/home?status=Listening+to+"+GUI.json.currentsong.replace(/\s+/g,"+")+"+by+"+GUI.json.currentartist.replace(/\s+/g,"+")+"+on+%40RuneAudio+http%3A%2F%2Fwww.runeaudio.com%2F+%23nowplaying";var g="https://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.runeaudio.com%2F&display=popup";var f="https://plus.google.com/share?url=http%3A%2F%2Fwww.runeaudio.com%2F";$("#urlTwitter").attr("href",h);$("#urlFacebook").attr("href",g);$("#urlGooglePlus").attr("href",f)}}}}e.click(function(){a()});b.click(function(){a()})};